{
  "terraform_snippets": {
    "name": "HigherSelf Terraform/Terragrunt Operations",
    "description": "Infrastructure management snippets for HigherSelf Network Server",
    "environments": ["development", "staging", "production"],
    "auto_import": true
  },
  "snippets": [
    {
      "id": "terraform-dev-init",
      "name": "ğŸ—ï¸ Initialize Development",
      "description": "Initialize Terraform for development environment",
      "command": "cd /path/to/higherself/terraform && echo 'ğŸ—ï¸ Initializing Development Environment...' && echo '=================================' && export TF_ENV=development && export AWS_PROFILE=higherself-dev && echo 'ğŸ”§ Setting up Terraform...' && ./init.sh development && echo 'ğŸŒ Selecting workspace...' && terraform workspace select development || terraform workspace new development && echo 'âœ… Development environment initialized!' && terraform --version",
      "tags": ["terraform", "development", "initialization"],
      "category": "Development Infrastructure",
      "environment": "development"
    },
    {
      "id": "terraform-dev-plan",
      "name": "ğŸ“‹ Plan Development Changes",
      "description": "Create and review Terraform plan for development",
      "command": "cd /path/to/higherself/terraform && echo 'ğŸ“‹ Creating Development Plan...' && echo '=============================' && export TF_ENV=development && export AWS_PROFILE=higherself-dev && echo 'ğŸ” Planning infrastructure changes...' && terraform plan -var-file='environments/development.tfvars' -out=dev.tfplan && echo '' && echo 'ğŸ“Š Plan Summary:' && terraform show -json dev.tfplan | jq '.resource_changes | group_by(.change.actions[]) | map({action: .[0].change.actions[0], count: length})' && echo 'âœ… Development plan created: dev.tfplan'",
      "tags": ["terraform", "development", "planning"],
      "category": "Development Infrastructure",
      "environment": "development"
    },
    {
      "id": "terraform-dev-apply",
      "name": "ğŸš€ Apply Development Changes",
      "description": "Apply Terraform changes to development environment",
      "command": "cd /path/to/higherself/terraform && echo 'ğŸš€ Applying Development Changes...' && echo '=================================' && export TF_ENV=development && if [ -f dev.tfplan ]; then echo 'âœ… Using existing plan: dev.tfplan' && terraform apply dev.tfplan && echo 'ğŸ“Š Deployment complete! Outputs:' && terraform output; else echo 'âŒ No plan file found. Run terraform-dev-plan first.'; fi",
      "tags": ["terraform", "development", "deployment"],
      "category": "Development Infrastructure",
      "environment": "development"
    },
    {
      "id": "terragrunt-staging-plan",
      "name": "ğŸ“‹ Plan Staging Deployment",
      "description": "Create Terragrunt plan for staging environment",
      "command": "cd /path/to/higherself && echo 'ğŸ“‹ Staging Environment Plan...' && echo '============================' && export TF_ENV=staging && export AWS_PROFILE=higherself-staging && echo 'ğŸ” Checking AWS credentials...' && aws sts get-caller-identity && echo 'ğŸ—ï¸ Running Terragrunt plan...' && ./terragrunt-deploy.sh staging plan && echo 'âœ… Staging plan complete!'",
      "tags": ["terragrunt", "staging", "planning"],
      "category": "Staging Infrastructure",
      "environment": "staging"
    },
    {
      "id": "terragrunt-staging-apply",
      "name": "ğŸš€ Deploy to Staging",
      "description": "Apply Terragrunt changes to staging environment",
      "command": "cd /path/to/higherself && echo 'ğŸš€ Deploying to Staging...' && echo '=========================' && export TF_ENV=staging && export AWS_PROFILE=higherself-staging && echo 'âš ï¸ STAGING DEPLOYMENT' && read -p 'ğŸ” Have you reviewed the plan? (yes/no): ' confirm && if [ \"$confirm\" = \"yes\" ]; then echo 'ğŸ—ï¸ Applying changes...' && ./terragrunt-deploy.sh staging apply && echo 'âœ… Staging deployment complete!'; else echo 'âŒ Deployment cancelled'; fi",
      "tags": ["terragrunt", "staging", "deployment"],
      "category": "Staging Infrastructure",
      "environment": "staging"
    },
    {
      "id": "terragrunt-prod-plan",
      "name": "ğŸ“‹ Plan Production (CRITICAL)",
      "description": "Create Terragrunt plan for production - REQUIRES APPROVAL",
      "command": "cd /path/to/higherself && echo 'ğŸš¨ PRODUCTION ENVIRONMENT PLAN' && echo '==============================' && echo 'âš ï¸ CRITICAL OPERATION - PRODUCTION INFRASTRUCTURE' && echo 'ğŸ“‹ This operation requires:' && echo '   - Security team approval' && echo '   - Change management ticket' && echo '   - MFA authentication' && echo '' && read -p 'ğŸ“ Enter change ticket number: ' ticket && read -p 'ğŸ” Enter MFA token: ' mfa && if [ ! -z \"$ticket\" ] && [ ! -z \"$mfa\" ]; then export TF_ENV=production && export AWS_PROFILE=higherself-production && echo \"ğŸ“‹ Change Ticket: $ticket\" && echo 'ğŸ—ï¸ Running production plan...' && ./terragrunt-deploy.sh production plan && echo 'âœ… Production plan complete - REQUIRES APPROVAL'; else echo 'âŒ Missing required information'; fi",
      "tags": ["terragrunt", "production", "planning", "critical"],
      "category": "Production Infrastructure",
      "environment": "production",
      "approval_required": true
    },
    {
      "id": "terraform-validate",
      "name": "âœ… Validate Configuration",
      "description": "Validate Terraform configuration files",
      "command": "cd /path/to/higherself/terraform && echo 'âœ… Validating Terraform Configuration...' && echo '====================================' && echo 'ğŸ” Checking syntax...' && terraform validate && echo 'ğŸ¨ Checking formatting...' && terraform fmt -check=true -recursive && echo 'ğŸ”’ Security scan...' && if command -v tfsec >/dev/null 2>&1; then tfsec . --format compact; else echo 'tfsec not installed - skipping security scan'; fi && echo 'âœ… Validation complete!'",
      "tags": ["terraform", "validation", "security"],
      "category": "Maintenance"
    },
    {
      "id": "terraform-format",
      "name": "ğŸ¨ Format Terraform Files",
      "description": "Format all Terraform configuration files",
      "command": "cd /path/to/higherself/terraform && echo 'ğŸ¨ Formatting Terraform Files...' && echo '===============================' && terraform fmt -recursive && echo 'âœ… All files formatted!'",
      "tags": ["terraform", "formatting", "maintenance"],
      "category": "Maintenance"
    },
    {
      "id": "terraform-state-list",
      "name": "ğŸ“‹ List Terraform Resources",
      "description": "List all resources in current Terraform state",
      "command": "cd /path/to/higherself/terraform && echo 'ğŸ“‹ Terraform State Resources...' && echo '==============================' && terraform state list | sort && echo '' && echo 'ğŸ“Š Resource Summary:' && terraform state list | cut -d. -f1 | sort | uniq -c | sort -nr",
      "tags": ["terraform", "state", "resources"],
      "category": "Information"
    },
    {
      "id": "terraform-output",
      "name": "ğŸ“Š Show Terraform Outputs",
      "description": "Display current Terraform output values",
      "command": "cd /path/to/higherself/terraform && echo 'ğŸ“Š Terraform Outputs...' && echo '=====================' && terraform output -json | jq '.' && echo '' && echo 'ğŸ”— Quick Access URLs:' && terraform output -json | jq -r 'to_entries[] | select(.value.value | type == \"string\" and test(\"^https?://\")) | \"\\(.key): \\(.value.value)\"'",
      "tags": ["terraform", "output", "information"],
      "category": "Information"
    },
    {
      "id": "aws-creds-check",
      "name": "ğŸ” Check AWS Credentials",
      "description": "Verify AWS credentials and permissions",
      "command": "echo 'ğŸ” AWS Credentials Check...' && echo '=========================' && echo 'ğŸ‘¤ Current Identity:' && aws sts get-caller-identity && echo '' && echo 'ğŸ« Session Token:' && aws sts get-session-token --duration-seconds 3600 | jq '.Credentials | {AccessKeyId, SecretAccessKey, SessionToken, Expiration}' && echo '' && echo 'ğŸ” Available Profiles:' && aws configure list-profiles && echo 'âœ… Credentials check complete!'",
      "tags": ["aws", "credentials", "verification"],
      "category": "AWS Management"
    },
    {
      "id": "aws-secrets-list",
      "name": "ğŸ”‘ List HigherSelf Secrets",
      "description": "List all HigherSelf secrets in AWS Secrets Manager",
      "command": "echo 'ğŸ”‘ HigherSelf AWS Secrets...' && echo '==========================' && aws secretsmanager list-secrets --filters Key=name,Values=higherself/ --query 'SecretList[].{Name:Name,Description:Description,LastChanged:LastChangedDate}' --output table && echo '' && echo 'ğŸ” Secret Details:' && aws secretsmanager list-secrets --filters Key=name,Values=higherself/ --query 'SecretList[].Name' --output text | xargs -I {} aws secretsmanager describe-secret --secret-id {} --query '{Name:Name,KmsKeyId:KmsKeyId,RotationEnabled:RotationEnabled}' --output table",
      "tags": ["aws", "secrets", "management"],
      "category": "AWS Management"
    },
    {
      "id": "terraform-cost-estimate",
      "name": "ğŸ’° Estimate Infrastructure Costs",
      "description": "Estimate costs for Terraform changes",
      "command": "cd /path/to/higherself/terraform && echo 'ğŸ’° Infrastructure Cost Estimation...' && echo '==================================' && if command -v infracost >/dev/null 2>&1; then echo 'ğŸ“Š Generating cost breakdown...' && infracost breakdown --path . --terraform-var-file environments/${TF_ENV:-development}.tfvars --format table && echo '' && echo 'ğŸ“ˆ Cost comparison:' && infracost diff --path . --terraform-var-file environments/${TF_ENV:-development}.tfvars; else echo 'âŒ infracost not installed. Install with: curl -fsSL https://raw.githubusercontent.com/infracost/infracost/master/scripts/install.sh | sh'; fi",
      "tags": ["terraform", "cost", "estimation"],
      "category": "Analysis"
    },
    {
      "id": "terraform-backup-state",
      "name": "ğŸ’¾ Backup Terraform State",
      "description": "Create backup of current Terraform state",
      "command": "cd /path/to/higherself/terraform && BACKUP_DIR=./backups/terraform/$(date +%Y%m%d-%H%M) && echo 'ğŸ’¾ Backing up Terraform State...' && echo '===============================' && mkdir -p $BACKUP_DIR && echo 'ğŸ“¦ Creating state backup...' && terraform state pull > $BACKUP_DIR/terraform-state-$(date +%Y%m%d-%H%M%S).json && echo 'ğŸ“¦ Backing up configuration...' && tar czf $BACKUP_DIR/terraform-config-$(date +%Y%m%d-%H%M%S).tar.gz *.tf environments/ modules/ 2>/dev/null || true && echo \"âœ… Backup completed in: $BACKUP_DIR\" && ls -la $BACKUP_DIR",
      "tags": ["terraform", "backup", "state"],
      "category": "Maintenance"
    },
    {
      "id": "terragrunt-run-all-plan",
      "name": "ğŸ“‹ Terragrunt Run-All Plan",
      "description": "Plan all Terragrunt modules in environment",
      "command": "cd /path/to/higherself/terragrunt/environments/${TF_ENV:-staging} && echo 'ğŸ“‹ Terragrunt Run-All Plan...' && echo '============================' && echo \"ğŸŒ Environment: ${TF_ENV:-staging}\" && terragrunt run-all plan --terragrunt-non-interactive && echo 'âœ… Run-all plan complete!'",
      "tags": ["terragrunt", "run-all", "planning"],
      "category": "Advanced Operations"
    },
    {
      "id": "infrastructure-health-check",
      "name": "ğŸ¥ Infrastructure Health Check",
      "description": "Check health of deployed infrastructure",
      "command": "echo 'ğŸ¥ Infrastructure Health Check...' && echo '================================' && echo 'ğŸ” Checking Terraform state...' && cd /path/to/higherself/terraform && terraform refresh -var-file=environments/${TF_ENV:-development}.tfvars && echo '' && echo 'ğŸ“Š Resource status:' && terraform state list | wc -l | xargs echo 'Total resources:' && echo '' && echo 'ğŸŒ Testing endpoints...' && terraform output -json | jq -r 'to_entries[] | select(.value.value | type == \"string\" and test(\"^https?://\")) | .value.value' | xargs -I {} curl -s -o /dev/null -w '{}: %{http_code}\\n' {} && echo 'âœ… Infrastructure health check complete!'",
      "tags": ["infrastructure", "health", "monitoring"],
      "category": "Monitoring"
    }
  ],
  "snippet_groups": [
    {
      "name": "ğŸ—ï¸ Development Infrastructure",
      "description": "Development environment management",
      "snippets": ["terraform-dev-init", "terraform-dev-plan", "terraform-dev-apply"]
    },
    {
      "name": "ğŸ¯ Staging Infrastructure", 
      "description": "Staging environment management",
      "snippets": ["terragrunt-staging-plan", "terragrunt-staging-apply"]
    },
    {
      "name": "ğŸš¨ Production Infrastructure",
      "description": "Production environment management - CRITICAL",
      "snippets": ["terragrunt-prod-plan"]
    },
    {
      "name": "ğŸ”§ Maintenance & Validation",
      "description": "Infrastructure maintenance operations",
      "snippets": ["terraform-validate", "terraform-format", "terraform-backup-state"]
    },
    {
      "name": "ğŸ“Š Information & Analysis",
      "description": "Infrastructure information and analysis",
      "snippets": ["terraform-state-list", "terraform-output", "terraform-cost-estimate", "infrastructure-health-check"]
    },
    {
      "name": "â˜ï¸ AWS Management",
      "description": "AWS-specific operations",
      "snippets": ["aws-creds-check", "aws-secrets-list"]
    }
  ],
  "environment_specific": {
    "development": {
      "required_snippets": ["terraform-dev-init", "terraform-dev-plan", "terraform-dev-apply"],
      "aws_profile": "higherself-dev",
      "auto_approve": false
    },
    "staging": {
      "required_snippets": ["terragrunt-staging-plan", "terragrunt-staging-apply"],
      "aws_profile": "higherself-staging",
      "auto_approve": false
    },
    "production": {
      "required_snippets": ["terragrunt-prod-plan"],
      "aws_profile": "higherself-production",
      "auto_approve": false,
      "approval_required": true,
      "mfa_required": true
    }
  }
}
